```mysql
CREATE TABLE users (
  id INT PRIMARY KEY AUTO_INCREMENT,
  user_id VARCHAR(30) NOT NULL UNIQUE,  -- 学号/工号
  username VARCHAR(50) NOT NULL UNIQUE,  -- 登录名
  password VARCHAR(255) NOT NULL,        -- bcrypt加密
  real_name VARCHAR(50) NOT NULL,
  phone VARCHAR(20),
  role_type ENUM('student','counselor','staff','admin') NOT NULL
);
CREATE TABLE students (
  user_id INT PRIMARY KEY,               -- 关联 users.id
  class_name VARCHAR(30) NOT NULL,       -- 如 软件2301
  department VARCHAR(50) NOT NULL,
  enrollment_year YEAR NOT NULL,
  is_difficult TINYINT DEFAULT 0         -- 是否困难生（0/1）
);
CREATE TABLE classes (
  name VARCHAR(30) PRIMARY KEY,          -- 软件2301
  counselor_id INT NOT NULL,             -- 辅导员 user_id
  FOREIGN KEY (counselor_id) REFERENCES users(id)
);
CREATE TABLE courses (
  id INT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(100) NOT NULL,
  code VARCHAR(20) NOT NULL
);
CREATE TABLE schedule (
  id INT PRIMARY KEY AUTO_INCREMENT,
  course_id INT NOT NULL,
  teacher_name VARCHAR(50) NOT NULL,     -- 教师姓名（文本即可）
  class_name VARCHAR(30) NOT NULL,       -- 面向班级
  day_of_week TINYINT NOT NULL,          -- 1=周一 ... 7=周日
  period_start TINYINT NOT NULL,
  period_end TINYINT NOT NULL,
  week_start TINYINT NOT NULL,
  week_end TINYINT NOT NULL,
  location VARCHAR(50) NOT NULL,
  semester VARCHAR(20) NOT NULL
);
CREATE TABLE grades (
  id INT PRIMARY KEY AUTO_INCREMENT,
  student_id INT NOT NULL,               -- users.id
  course_id INT NOT NULL,
  score DECIMAL(5,2),
  semester VARCHAR(20) NOT NULL,
  UNIQUE(student_id, course_id, semester)
);
CREATE TABLE records (
  id INT PRIMARY KEY AUTO_INCREMENT,
  student_id INT NOT NULL,
  type ENUM('attendance','reward','penalty','comprehensive','employment') NOT NULL,
  
  -- 通用字段
  title VARCHAR(100),                    -- 如 "迟到", "校级奖学金", "已签约"
  content TEXT,                          -- 详情
  date DATE NOT NULL,
  operator_id INT NOT NULL,              -- 操作人（辅导员/学工）
  
  -- 就业专用
  company VARCHAR(100),
  salary DECIMAL(10,2),
  
  -- 综合素质专用
  moral_score DECIMAL(4,1) DEFAULT 0,
  intellectual_score DECIMAL(4,1) DEFAULT 0,
  -- ...其他维度
  
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
CREATE TABLE difficulty_apps (
  id INT PRIMARY KEY AUTO_INCREMENT,
  student_id INT NOT NULL,
  family_income DECIMAL(10,2),
  description TEXT,
  status ENUM('pending','approved','rejected') DEFAULT 'pending',
  reviewer_id INT,                       -- 审核人
  reviewed_at DATETIME,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

**数据库概览**

- 面向“学生管理/教务”的核心实体与关系，包含用户、班级、学生、课程、课表、成绩、学生事务记录、困难申请。
- 主键与外键统一：学生相关表统一指向学生在用户表的内部主键（users.id），并在 students 中以 user_id 作为该外键主键。

**users 表（用户）**

- id：系统内部主键（整型，自增），后续关联都用它。
- user_id：外部学号/工号（字符串，唯一），用于对接校方系统、报表展示等。
- username：登录名（字符串，唯一）。
- password：密码哈希（字符串，通常为 bcrypt 哈希，不存明文）。
- real_name：真实姓名（字符串）。
- phone：手机号（字符串，可空）。
- role_type：角色类型（枚举：student/counselor/staff/admin），用于基本权限区分。

**classes 表（班级）**

- name：班级名称（字符串，主键，如 软件2301）。
- counselor_id：辅导员用户主键（外键到 users.id）。

**students 表（学生档案）**

- user_id：学生对应的用户主键（外键到 users.id，同时是本表主键）。
- class_name：所属班级名（外键到 classes.name）。
- department：院系/专业（字符串，如“软件工程”）。
- enrollment_year：入学年份（YEAR）。
- is_difficult：是否困难生（TINYINT(1)，0/1），并有检查约束限制取值。

说明：这里的 students.user_id 是指向 users.id 的“内部主键”，与 users.user_id（学号/工号，字符串）不是同一个含义。

**courses 表（课程）**

- id：课程主键（自增）。
- name：课程名称（字符串）。
- code：课程编码（字符串，唯一，如 CS101），便于对接教务与避免重复。

**schedule 表（课表/排课）**

- id：课表条目主键（自增）。
- course_id：课程主键（外键到 courses.id）。
- teacher_name：授课教师姓名（字符串，文本即可）。
- class_name：面向班级（外键到 classes.name）。
- day_of_week：周几（TINYINT，1=周一 ... 7=周日，有检查约束）。
- period_start / period_end：第几节开始/结束（TINYINT，有检查约束要求开始≤结束）。
- week_start / week_end：第几周开始/结束（TINYINT，约束 1–30 且开始≤结束）。
- location：上课地点（字符串）。
- semester：学期标识（字符串，如 2024-Fall），建议固定规范。
- 索引：按班级+周次+周几、按班级+学期+周几建立索引，常用查询更快。
- 外键策略：删除班级时默认限制（ON DELETE RESTRICT），避免误删导致课表级联丢失；班级改名联动更新（ON UPDATE CASCADE）。

**grades 表（成绩）**

- id：成绩主键（自增）。
- student_id：学生主键（外键到 students.user_id）。
- course_id：课程主键（外键到 courses.id）。
- score：分数（DECIMAL(5,2)）。
- semester：学期标识（字符串）。
- 唯一约束：UNIQUE(student_id, course_id, semester)，防止同学期同课程重复成绩。
- 索引：(student_id, semester)，常用统计和查询优化。

**records 表（学生事务记录，合表）**

- id：记录主键（自增）。
- student_id：学生主键（外键到 students.user_id）。
- type：记录类型（枚举：attendance/reward/penalty/comprehensive/employment）。
- title：简短标题（字符串，如“迟到”、“校级奖学金”）。
- content：详情说明（TEXT）。
- date：发生日期（DATE）。
- operator_id：操作人用户主键（外键到 users.id），通常是辅导员/学工。
- 类型专属字段：
  - company / salary：就业类型专用（签约单位/薪资）。
  - moral_score / intellectual_score：综合素质类型专用（德育/智育维度分）。
- 审计字段：created_at、updated_at（TIMESTAMP，自动记录创建与更新时间）。
- 索引：(student_id, type)，便于按学生与类型筛选。

说明：为统一与简单，采用“合表”存储不同类型记录；若需要更强约束可在后续拆分子表。

**difficulty_apps 表（困难生认定申请）**

- id：申请主键（自增）。
- student_id：申请学生主键（外键到 students.user_id）。
- family_income：家庭月收入（DECIMAL(10,2)）。
- description：困难说明（TEXT）。
- status：申请状态（枚举：pending/approved/rejected）。
- reviewer_id：审核人用户主键（外键到 users.id）。
- reviewed_at：审核时间（DATETIME）。
- 审计字段：created_at、updated_at（TIMESTAMP）。
- 索引：(student_id, status)，便于筛选某学生的申请与状态统计。

**关系说明（文字版 ER）**

- users 是所有人员的基础表；students 用 user_id → users.id 标识“该用户是学生”，并补充学生属性。
- classes 由 users 中的 counselor 管理；students 归属某 classes.name。
- courses 定义课程，schedule 将课程分配到班级和具体时间地点。
- grades 关联学生与课程并记录成绩。
- records 记录学生在校的各类事务（出勤、奖励、惩罚、综合评价、就业）。
- difficulty_apps 记录学生的困难认定申请及审核流程。

**常见查询示例**

- 查询某班某学期的课表：按 schedule.class_name + semester + day_of_week。
- 查询某学生某学期成绩：按 grades.student_id + semester。
- 查询某学生所有奖惩：records.student_id 且 records.type IN ('reward','penalty')。
- 查询待审核的困难申请：difficulty_apps.status='pending' 并联表 reviewer 或按时间排序。

如果你需要，我可以：

- 提供一份常用 SQL 查询模板清单（课表、成绩、事务记录、困难申请统计）。
- 在前端补一个“忘记密码/重置密码”流程对应的表与接口示例。
- 按你的现有后端栈生成对应的迁移脚本与数据访问层代码。
